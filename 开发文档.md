# 文件系统

# 目录系统

# 内存系统

# 磁盘系统

## 1. 文件如何存储

文件对象的各属性必须能序列化为字符串，以 '$' 符号作为文件各属性的分隔符，最终在磁盘中以char数组的形式存储。

## 2. 文件如何读取

1. 操作系统重启
2. 进程调用文件系统的初始化函数
3. 文件系统的初始化函数调用内存系统的初始化函数
4. 内存系统的初始化函数调用磁盘系统的初始化函数
5. 磁盘系统的初始化函数返回其超级块中的内容，包括：文件系统存进来的目录信息，文件系统存进来的文件信息，FAT表。
6. 内存系统找空闲块把超级块中的内容存进来，供下一步文件系统使用。
7. 文件系统调用内存系统的 读取目录信息函数、读取文件信息函数、把内存系统中的内容读取出来，重新生成树形目录。
8. 初始化完成
9. 进程收到用户打开文件的命令，建立新进程，调用文件系统的建立文件进程函数，传入文件所在的路径
10. 文件系统的建立文件进程函数调用内存系统的分配内存块函数，分配8个内存块，返回内存块的起始地址。（注意返回的是虚拟地址，注意地址映射）
11. 文件系统的建立文件进程函数调用内存系统的读FAT表函数，从文件的起始盘块号开始，读取FAT表，直到读到文件的最后一个盘块号，确定文件占几个盘块。
12. 文件系统调用内存系统的初始载入函数，把文件的起始盘块号传入，内存系统根据文件的起始盘块号，把文件的盘块载入到分配的内存中（不一定存的完，反正最多存满分配的8个块就停），然后更新映射。（注意地址映射）
13. 文件系统的建立文件进程函数调用内存系统的读取文件信息函数，传入虚拟地址。在有了文件的起始虚拟地址和文件占几个盘块的情况下，文件系统可以精准确定需要读取的地址，从而读取到文件的每一个字节。由于现在是从无到有生成文件对象，所以文件系统需要按顺序读取文件的每一个字节，然后把文件的各个属性填充到文件对象中。（反序列化）
14. 在12步中，文件系统调用内存系统的读取文件信息函数，内存需要将虚拟地址转换为自己的内存地址，在虚拟地址的范围超出内存的范围时进行缺页中断，调用磁盘系统的读取函数，读取文件的盘块到内存中，然后更新映射。（这意味着内存系统需要有一个页表，用于虚拟地址到物理地址的映射）


# Qt界面